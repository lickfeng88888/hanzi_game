<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词拼搭 - 英语游戏</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/common/footer.css">
    <link rel="stylesheet" href="../../css/english/wordBuilder.css">
    <script>
        class WordBuilder {
            constructor() {
                this.currentLevel = 1;
                this.currentScore = 0;
                this.currentWord = null;
                this.currentFragments = [];
                this.wordIndex = 0;

                // 游戏数据
                this.gameData = {
                    levels: [
                        {
                            name: "初级 - 日常用品",
                            words: [
                                {
                                    word: "table",
                                    fragments: ["ta", "ble"],
                                    hint: "一件带有平面的家具...",
                                    definition: "桌子，一件带有平面和腿的家具",
                                    example: "Please put the books on the table."
                                },
                                {
                                    word: "chair",
                                    fragments: ["ch", "air"],
                                    hint: "用来坐的家具...",
                                    definition: "椅子，一种用来坐的家具",
                                    example: "He sat down on the chair."
                                },
                                {
                                    word: "phone",
                                    fragments: ["ph", "one"],
                                    hint: "用来通讯的设备...",
                                    definition: "电话，一种通讯设备",
                                    example: "I need to charge my phone."
                                },
                                {
                                    word: "clock",
                                    fragments: ["cl", "ock"],
                                    hint: "用来看时间的物品...",
                                    definition: "时钟，显示时间的装置",
                                    example: "The clock shows 3 o'clock."
                                },
                                {
                                    word: "pencil",
                                    fragments: ["pen", "cil"],
                                    hint: "用来写字画画的文具...",
                                    definition: "铅笔，书写工具",
                                    example: "She writes with a pencil."
                                }
                            ]
                        },
                        {
                            name: "初级 - 食物",
                            words: [
                                {
                                    word: "apple",
                                    fragments: ["ap", "ple"],
                                    hint: "一种红色或绿色的水果...",
                                    definition: "苹果，一种常见的水果",
                                    example: "An apple a day keeps the doctor away."
                                },
                                {
                                    word: "bread",
                                    fragments: ["br", "ead"],
                                    hint: "早餐常见的主食...",
                                    definition: "面包，一种主食",
                                    example: "I like fresh bread for breakfast."
                                },
                                {
                                    word: "pizza",
                                    fragments: ["pi", "zza"],
                                    hint: "一种意大利圆形食物...",
                                    definition: "披萨，一种意大利食物",
                                    example: "Let's order a pizza for dinner."
                                },
                                {
                                    word: "cake",
                                    fragments: ["ca", "ke"],
                                    hint: "生日常见的甜点...",
                                    definition: "蛋糕，一种甜点",
                                    example: "She made a birthday cake."
                                },
                                {
                                    word: "rice",
                                    fragments: ["ri", "ce"],
                                    hint: "亚洲主要的主食...",
                                    definition: "米饭，一种主食",
                                    example: "We eat rice every day."
                                }
                            ]
                        },
                        {
                            name: "中级 - 动物",
                            words: [
                                {
                                    word: "tiger",
                                    fragments: ["ti", "ger"],
                                    hint: "一种大型猫科动物...",
                                    definition: "老虎，一种凶猛的猫科动物",
                                    example: "The tiger is hunting in the forest."
                                },
                                {
                                    word: "monkey",
                                    fragments: ["mon", "key"],
                                    hint: "一种喜欢爬树的动物...",
                                    definition: "猴子，一种灵长类动物",
                                    example: "The monkey is swinging from tree to tree."
                                },
                                {
                                    word: "rabbit",
                                    fragments: ["rab", "bit"],
                                    hint: "一种有长耳朵的动物...",
                                    definition: "兔子，一种有长耳朵的哺乳动物",
                                    example: "The rabbit is eating a carrot."
                                },
                                {
                                    word: "penguin",
                                    fragments: ["pen", "guin"],
                                    hint: "一种不会飞的南极鸟类...",
                                    definition: "企鹅，一种生活在南极的鸟类",
                                    example: "Penguins swim very well in cold water."
                                },
                                {
                                    word: "giraffe",
                                    fragments: ["gi", "raffe"],
                                    hint: "一种脖子很长的动物...",
                                    definition: "长颈鹿，一种脖子很长的非洲动物",
                                    example: "The giraffe can reach the highest leaves."
                                }
                            ]
                        },
                        {
                            name: "中级 - 职业",
                            words: [
                                {
                                    word: "teacher",
                                    fragments: ["tea", "cher"],
                                    hint: "在学校教书的人...",
                                    definition: "教师，从事教育工作的人",
                                    example: "Our teacher is very kind."
                                },
                                {
                                    word: "doctor",
                                    fragments: ["doc", "tor"],
                                    hint: "在医院工作的人...",
                                    definition: "医生，治疗病人的专业人士",
                                    example: "The doctor helped me feel better."
                                },
                                {
                                    word: "police",
                                    fragments: ["po", "lice"],
                                    hint: "维护治安的人...",
                                    definition: "警察，维护社会治安的人",
                                    example: "The police caught the thief."
                                },
                                {
                                    word: "farmer",
                                    fragments: ["far", "mer"],
                                    hint: "种地的人...",
                                    definition: "农民，从事农业生产的人",
                                    example: "The farmer grows vegetables."
                                },
                                {
                                    word: "driver",
                                    fragments: ["dri", "ver"],
                                    hint: "开车的人...",
                                    definition: "司机，驾驶车辆的人",
                                    example: "The bus driver is very careful."
                                }
                            ]
                        },
                        {
                            name: "高级 - 三音节",
                            words: [
                                {
                                    word: "butterfly",
                                    fragments: ["but", "ter", "fly"],
                                    hint: "一种美丽的昆虫...",
                                    definition: "蝴蝶，一种有彩色翅膀的昆虫",
                                    example: "The butterfly is flying in the garden."
                                },
                                {
                                    word: "computer",
                                    fragments: ["com", "pu", "ter"],
                                    hint: "用来处理数据的电子设备...",
                                    definition: "电脑，一种电子计算设备",
                                    example: "I use my computer every day."
                                },
                                {
                                    word: "umbrella",
                                    fragments: ["um", "bre", "lla"],
                                    hint: "下雨时用来遮挡的物品...",
                                    definition: "雨伞，用来遮挡雨水的工具",
                                    example: "Take an umbrella, it might rain."
                                },
                                {
                                    word: "hospital",
                                    fragments: ["hos", "pi", "tal"],
                                    hint: "治疗病人的地方...",
                                    definition: "医院，提供医疗服务的场所",
                                    example: "The hospital is open 24 hours."
                                },
                                {
                                    word: "elephant",
                                    fragments: ["e", "le", "phant"],
                                    hint: "最大的陆地动物...",
                                    definition: "大象，体型最大的陆地动物",
                                    example: "The elephant has a long trunk."
                                }
                            ]
                        },
                        {
                            name: "高级 - 复合词",
                            words: [
                                {
                                    word: "classroom",
                                    fragments: ["class", "room"],
                                    hint: "学习的房间...",
                                    definition: "教室，进行课程教学的房间",
                                    example: "Students study in the classroom."
                                },
                                {
                                    word: "football",
                                    fragments: ["foot", "ball"],
                                    hint: "一种用脚踢的球类运动...",
                                    definition: "足球，一种球类运动",
                                    example: "They play football every weekend."
                                },
                                {
                                    word: "notebook",
                                    fragments: ["note", "book"],
                                    hint: "记笔记用的本子...",
                                    definition: "笔记本，用来记录的本子",
                                    example: "I write in my notebook during class."
                                },
                                {
                                    word: "sunlight",
                                    fragments: ["sun", "light"],
                                    hint: "太阳发出的光...",
                                    definition: "阳光，太阳发出的光线",
                                    example: "Plants need sunlight to grow."
                                },
                                {
                                    word: "toothbrush",
                                    fragments: ["tooth", "brush"],
                                    hint: "刷牙用的工具...",
                                    definition: "牙刷，用来清洁牙齿的工具",
                                    example: "Remember to use your toothbrush."
                                }
                            ]
                        }
                    ],
                    levelInfo: {
                        level: 1,
                        difficulty: "easy",
                        requiredScore: 30,
                        timeLimit: 300
                    }
                };

                this.initializeElements();
                this.bindEvents();
                this.initGame();
            }

            initializeElements() {
                this.buildingArea = document.getElementById('buildingArea');
                this.fragmentsArea = document.getElementById('fragmentsArea');
                this.hintButton = document.getElementById('hintButton');
                this.checkButton = document.getElementById('checkButton');
                this.nextButton = document.getElementById('nextButton');
                this.levelElement = document.getElementById('currentLevel');
                this.scoreElement = document.getElementById('currentScore');
                this.modal = document.getElementById('modal');
                this.modalContent = document.getElementById('modalContent');
                this.closeModal = document.getElementById('closeModal');
                this.wordDisplay = document.getElementById('wordDisplay');
            }

            bindEvents() {
                this.hintButton.addEventListener('click', () => this.showHint());
                this.checkButton.addEventListener('click', () => this.checkAnswer());
                this.nextButton.addEventListener('click', () => this.nextWord());
                this.closeModal.addEventListener('click', () => this.hideModal());
                
                // 点击模态框外部关闭
                window.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hideModal();
                    }
                });
            }

            showModal(content, type = '') {
                this.modalContent.innerHTML = content;
                this.modal.className = `modal ${type}`;
                this.modal.style.display = 'flex';
            }

            hideModal() {
                this.modal.style.display = 'none';
            }

            initGame() {
                this.updateScoreDisplay();
                this.updateLevelDisplay();
                this.loadWord();
            }

            loadWord() {
                if (!this.gameData || !this.gameData.levels) return;
                
                const levelData = this.gameData.levels[this.wordIndex];
                if (!levelData) {
                    this.completedLevel();
                    return;
                }

                const wordData = levelData.words[0];
                if (!wordData) {
                    this.completedLevel();
                    return;
                }

                this.currentWord = wordData.word;
                this.currentFragments = [...wordData.fragments];
                
                // 更新单词显示
                this.wordDisplay.textContent = '_ '.repeat(this.currentWord.length).trim();
                
                this.buildingArea.innerHTML = '';
                this.fragmentsArea.innerHTML = '';
                
                this.shuffleArray(this.currentFragments);
                this.displayFragments();
                
                this.checkButton.style.display = 'block';
                this.nextButton.style.display = 'none';
            }

            displayFragments() {
                this.currentFragments.forEach(fragment => {
                    const fragmentElement = document.createElement('div');
                    fragmentElement.className = 'word-fragment';
                    fragmentElement.textContent = fragment;
                    fragmentElement.draggable = true;
                    
                    fragmentElement.addEventListener('dragstart', (e) => this.handleDragStart(e));
                    fragmentElement.addEventListener('dragend', (e) => this.handleDragEnd(e));
                    
                    this.fragmentsArea.appendChild(fragmentElement);
                });

                this.buildingArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
                
                this.buildingArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const fragment = document.querySelector('.dragging');
                    if (fragment) {
                        this.buildingArea.appendChild(fragment);
                        fragment.classList.add('placed');
                        this.updateWordDisplay();
                    }
                });
            }

            updateWordDisplay() {
                const placedFragments = Array.from(this.buildingArea.children)
                    .map(fragment => fragment.textContent)
                    .join('');
                this.wordDisplay.textContent = placedFragments || '_ '.repeat(this.currentWord.length).trim();
            }

            handleDragStart(e) {
                e.target.classList.add('dragging');
                e.dataTransfer.setData('text/plain', e.target.textContent);
                e.dataTransfer.effectAllowed = 'move';
            }

            handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            showHint() {
                const levelData = this.gameData.levels[this.wordIndex];
                const wordData = levelData.words[0];
                const hintContent = `
                    <h3>单词提示</h3>
                    <p><strong>提示：</strong>${wordData.hint}</p>
                    <p><strong>释义：</strong>${wordData.definition}</p>
                    <p><strong>例句：</strong>${wordData.example}</p>
                `;
                this.showModal(hintContent, 'hint');
            }

            checkAnswer() {
                const placedFragments = Array.from(this.buildingArea.children)
                    .map(fragment => fragment.textContent)
                    .join('');
                
                if (placedFragments === this.currentWord) {
                    this.handleCorrectAnswer();
                } else {
                    this.handleIncorrectAnswer();
                }
            }

            handleCorrectAnswer() {
                const levelData = this.gameData.levels[this.wordIndex];
                const wordData = levelData.words[0];
                this.currentScore += 10;
                this.updateScoreDisplay();
                
                const successContent = `
                    <h3>恭喜！答对了！</h3>
                    <div class="word-info">
                        <p><strong>单词：</strong>${wordData.word}</p>
                        <p><strong>释义：</strong>${wordData.definition}</p>
                        <p><strong>例句：</strong>${wordData.example}</p>
                    </div>
                    <p class="score-info">+10分</p>
                `;
                this.showModal(successContent, 'success');
                
                this.checkButton.style.display = 'none';
                this.nextButton.style.display = 'block';
                
                Array.from(this.buildingArea.children).forEach(fragment => {
                    fragment.classList.add('correct');
                });
            }

            handleIncorrectAnswer() {
                const errorContent = `
                    <h3>再试一次！</h3>
                    <p>单词拼写不正确，请重新尝试。</p>
                `;
                this.showModal(errorContent, 'error');
                
                Array.from(this.buildingArea.children).forEach(fragment => {
                    fragment.classList.add('incorrect');
                    setTimeout(() => fragment.classList.remove('incorrect'), 500);
                });
            }

            nextWord() {
                this.hideModal();
                this.wordIndex++;
                if (this.wordIndex >= this.gameData.levels.length) {
                    this.completedLevel();
                } else {
                    this.loadWord();
                }
            }

            completedLevel() {
                const requiredScore = this.gameData.levelInfo.requiredScore;
                if (this.currentScore >= requiredScore) {
                    this.currentLevel++;
                    const successContent = `
                        <h3>恭喜！关卡完成！</h3>
                        <p>你的得分：${this.currentScore}</p>
                        <p>进入下一关！</p>
                    `;
                    this.showModal(successContent, 'success');
                    setTimeout(() => {
                        this.hideModal();
                        this.wordIndex = 0;
                        this.initGame();
                    }, 2000);
                } else {
                    const failContent = `
                        <h3>继续加油！</h3>
                        <p>当前得分：${this.currentScore}</p>
                        <p>目标分数：${requiredScore}</p>
                        <p>重新开始本关卡</p>
                    `;
                    this.showModal(failContent, 'error');
                    setTimeout(() => {
                        this.hideModal();
                        this.wordIndex = 0;
                        this.loadWord();
                    }, 2000);
                }
            }

            updateScoreDisplay() {
                this.scoreElement.textContent = this.currentScore;
            }

            updateLevelDisplay() {
                this.levelElement.textContent = this.currentLevel;
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new WordBuilder();
        });
    </script>
</head>
<body>
    <div class="back-button">
        <button onclick="window.location.href='../../index.html'">返回主页</button>
    </div>
    <main class="game-container">
        <div class="game-info">
            <div class="level-info">关卡：<span id="currentLevel">1</span></div>
            <div class="score-info">得分：<span id="currentScore">0</span></div>
        </div>

        <div class="word-display">
            <h3>当前单词</h3>
            <div id="wordDisplay" class="current-word"></div>
        </div>

        <div class="building-area" id="buildingArea">
            <!-- 拖放区域 -->
        </div>

        <div class="fragments-area" id="fragmentsArea">
            <!-- 单词片段区域 -->
        </div>

        <div class="button-container">
            <button class="hint-button" id="hintButton">显示提示</button>
            <button class="check-button" id="checkButton">检查答案</button>
            <button class="next-button" id="nextButton" style="display: none;">下一个</button>
        </div>
    </main>
    <footer class="footer">
        <p>2024 儿童互动游戏教学平台 - 让学习更有趣！</p>
        <p>2024 儿童互动游戏乐园 by lickfeng</p>
        <p>交流讨论请添加微信：lick-feng</p>
    </footer>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>
</body>
</html>
